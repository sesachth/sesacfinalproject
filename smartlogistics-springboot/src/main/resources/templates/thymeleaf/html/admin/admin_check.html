<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorator="~{/thymeleaf/html/common/default_layout}">
<head>
	<th:block layout:fragment="css">
		<link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
		<script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
	    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
	    <style>
			#boxImage {
				width: 500px;
				height: 500px;
				object-fit: cover; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ë°•ìŠ¤ í¬ê¸°ì— ë§ì¶¤ */
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}
			.hidden {
				display: none;
			}
		</style>
	</th:block>
</head>

<th:block layout:fragment="wrapper">
    	<div class="outside-container">
        	<div class="main-container">
                <div th:replace="~{thymeleaf/html/common/include::profile}"></div>
				<div th:replace="~{thymeleaf/html/common/include::sidebar}"></div>
            	<div layout:fragment="content" class="main-content">
            		<!-- ğŸ“¦ ì„ íƒëœ ë°•ìŠ¤ ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­ -->
	                <div id="imageContainer" class="mt-4">
	                    <h3 class="text-lg font-semibold">ğŸ“¦ë°•ìŠ¤ ì´ë¯¸ì§€</h3>
	                    <img id="boxImage" src="" alt="ë°•ìŠ¤ ì´ë¯¸ì§€" class="hidden" />
	                </div>
	                
	                <div id="check_result" >
	                
	                </div>
            	</div>
        	</div>
        </div>
</th:block>
    
    <!-- âœ… WebSocket ì—°ê²° ë° êµ¬ë… ìŠ¤í¬ë¦½íŠ¸ -->
	<script>
    var socket = new SockJS('/ws');  // /ws/progressë¡œ ì—°ê²°
    var stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log("WebSocket ì—°ê²°ë¨: " + frame);

        stompClient.subscribe('/topic/updateImage', function (messageOutput) {
            var message = JSON.parse(messageOutput.body); // JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            var imageUrl = message.imageUrl;  // ìˆ˜ì‹ ëœ ì´ë¯¸ì§€ URL
            var boxState = message.boxState;  // boxState ê°’ ë°›ê¸°
            console.log("ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :", imageUrl, "ë°•ìŠ¤ ìƒíƒœ:", boxState);
            
            var boxImage = document.getElementById('boxImage');
            boxImage.src = imageUrl;               // âœ… ê¸°ì¡´ ì´ë¯¸ì§€ ì‚¬ìš©
            boxImage.classList.remove('hidden');   // ìˆ¨ê¹€ í•´ì œs

            // ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— í‘œì‹œ
            //var imageContainer = document.getElementById('imageContainer');
            //var imgElement = document.createElement('img');
            //imgElement.src = imageUrl;
            //imageContainer.innerHTML = '';  // ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ
            //imageContainer.appendChild(imgElement);
            
         	// âœ… ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
            document.body.style.backgroundColor = (boxState === 2) ? "#ffebee" : "#e8f5e9";
        });
    });
</script>
</html>