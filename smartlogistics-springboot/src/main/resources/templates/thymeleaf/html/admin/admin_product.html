<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="~{/thymeleaf/html/common/default_layout}">


<head>
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
	<link rel="stylesheet" href="/css/admin/admin_product.css">
</th:block>
</head>

<body>
	<th:block layout:fragment="wrapper">
		<div class="outside-container">
			<div class="main-container">
				<div th:replace="~{thymeleaf/html/common/include::profile}"></div>
				<div th:replace="~{thymeleaf/html/common/include::sidebar}"></div>
				<!-- 상단 버튼 -->
				<div class="product-actions">
					<button type="button" class="btn btn-primary"
						data-bs-toggle="modal" data-bs-target="#exampleModal">
						Add Product</button>
				</div>
				<div layout:fragment="content" class="main-content">





					<!-- 제품 목록 테이블 -->
					<div class="table-container">
						<table class="product-table" id="productTable">

							<h1>Product List</h1>

							<form action="/admin/product/search" method="get" class="search-form" style="display:inline-block; margin-left:20px;">
								<input type="text" name="name" placeholder="제품명 검색" required th:value="${searchQuery}" />
								<button type="submit">검색</button>
							</form>

							<form action="/admin/product" method="get">
								<label for="categoryFilter">Category</label> <select
									name="filter" id="categoryFilter" onchange="this.form.submit()">
									<option value="전체" th:selected="${selectedCategory eq '전체'}">전체</option>
									<option value="잡화류" th:selected="${selectedCategory eq '잡화류'}">잡화류</option>
									<option value="전자제품류"
										th:selected="${selectedCategory eq '전자제품류'}">전자제품류</option>
									<option value="가공식품"
										th:selected="${selectedCategory eq '가공식품'}">가공식품</option>
									<option value="제과류" th:selected="${selectedCategory eq '제과류'}">제과류</option>
									<option value="음료" th:selected="${selectedCategory eq '음료'}">음료</option>
									<option value="의류" th:selected="${selectedCategory eq '의류'}">의류</option>
									<option value="세정용 화장품류"
										th:selected="${selectedCategory eq '세정용 화장품류'}">세정용
										화장품류</option>
									<option value="그 밖의 화장품류"
										th:selected="${selectedCategory eq '그 밖의 화장품류'}">그 밖의
										화장품류</option>
									<option value="의약외품류"
										th:selected="${selectedCategory eq '의약외품류'}">의약외품류</option>
									<option value="세제류" th:selected="${selectedCategory eq '세제류'}">세제류</option>
									<option value="건강기능식품"
										th:selected="${selectedCategory eq '건강기능식품'}">건강기능식품</option>
								</select>
							</form>

							<form action="/admin/product" method="get">
								<label for="fragileFilter">Fragile </label> <select
									name="fragile" id="fragileFilter" onchange="this.form.submit()">
									<!-- 전체 선택 시 value를 빈 문자열로 하여 null로 받음 -->
									<option value="전체" th:selected="${selectedFragile == '전체'}">전체</option>
									<option value="true" th:selected="${selectedFragile == true}">Yes</option>
									<option value="false" th:selected="${selectedFragile == false}">No</option>
								</select>
							</form>

							
								<thead>
									<tr>
										<th>NO.</th>
										<th>Name</th>
										<th>Width</th>
										<th>Depth</th>
										<th>Height</th>
										<th>Weight</th>
										<th>Category</th>
										<th>Fragile</th>
										<th>action</th>
									</tr>
								</thead>

								
								<tbody>
									<tr th:each="product, iterStat : ${products}">
										<td th:text="${iterStat.index + 1}"></td>
										<!-- ID 대신 1부터 시작하는 인덱스 -->
										<td th:text="${product.name}"></td>
										<td th:text="${product.width}"></td>
										<td th:text="${product.depth}"></td>
										<td th:text="${product.height}"></td>
										<td th:text="${product.weight}"></td>
										<td th:text="${product.category}"></td>
										<td
											th:text="${product.fragile != null ? (product.fragile ? 'Yes' : 'No') : 'No'}"></td>
										<td>
											<form th:action="@{/admin/product/update}" method="post"
												id="productEdit">
												<input type="hidden" name="productId"
													th:value="${product.productId}" />
												<button type="submit">Edit</button>
											</form> <a
											th:href="@{/admin/product/delete/{id}(id=${product.productId})}">Delete</a>
									</tr>

									<tr th:if="${products.size() == 0}">
										<td colspan="9" style="text-align: center;">No products
											found.</td>
									</tr>

								</tbody>

							</table>
					</div>

					<!-- 페이지네이션 -->
					<div class="pagination">
						<button id="prevGroup">«</button>
						<span id="pageNumbers"></span>
						<button id="nextGroup">»</button>
					</div>

				</div>
			</div>
		</div>
	</th:block>

	<div class="modal fade" id="exampleModal" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="exampleModalLabel">Add
						Product</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form th:action="@{/admin/product/add}" method="post"
						id="productAdd">
						<input type="hidden" name="filter" th:value="${selectedCategory}" />
						Name: <input type="text" name="name" required /><br /> Width: <input
							type="number" name="width" required /><br /> Depth: <input
							type="number" name="depth" required /><br /> Height: <input
							type="number" name="height" required /><br /> Weight: <input
							type="number" name="weight" required /><br />

						<!-- 카테고리 선택 -->
						Category: <select name="category" required>
							<option value="잡화류">잡화류</option>
							<option value="전자제품류">전자제품류</option>
							<option value="가공식품">가공식품</option>
							<option value="제과류">제과류</option>
							<option value="음료">음료</option>
							<option value="의류">의류</option>
							<option value="세정용 화장품류">세정용 화장품류</option>
							<option value="그 밖의 화장품류">그 밖의 화장품류</option>
							<option value="의약외품류">의약외품류</option>
							<option value="세제류">세제류</option>
							<option value="건강기능식품">건강기능식품</option>
						</select><br /> Fragile: <input type="checkbox" name="fragile"
							id="fragileCheckbox"
							th:checked="${product != null && product.fragile}" value="true" />
						<input type="hidden" name="fragile" id="fragileHidden"
							value="false" />
					</form>
					<script>
						document
								.getElementById("fragileCheckbox")
								.addEventListener(
										"change",
										function() {
											document
													.getElementById("fragileHidden").disabled = this.checked;
										});
					</script>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary" id="submit-btn">Submit</button>

				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>

	<!-- 페이징 기능 스크립트 -->
	<script>
		document
				.addEventListener(
						"DOMContentLoaded",
						function() {
							var currentPage = 1;
							var rowsPerPage = 10; // 한 페이지당 표시할 행 수
							var pageGroupSize = 10; // 페이지 번호 그룹 크기

							var table = document.getElementById("productTable");
							var tbody = table.querySelector("tbody");
							var rows = Array.from(tbody
									.getElementsByTagName("tr"));
							var totalPages = Math.ceil(rows.length
									/ rowsPerPage);

							function updateTable() {
								rows.forEach(function(row) {
									row.style.display = "none";
								});
								var startIndex = (currentPage - 1)
										* rowsPerPage;
								var endIndex = Math.min(startIndex
										+ rowsPerPage, rows.length);
								for (var i = startIndex; i < endIndex; i++) {
									rows[i].style.display = "";
								}
							}

							function updatePagination() {
								var pageNumbersElement = document
										.getElementById("pageNumbers");
								pageNumbersElement.innerHTML = "";
								var startPage = Math.floor((currentPage - 1)
										/ pageGroupSize)
										* pageGroupSize + 1;
								var endPage = Math.min(startPage
										+ pageGroupSize - 1, totalPages);
								for (var i = startPage; i <= endPage; i++) {
									var btn = document.createElement("button");
									btn.innerText = i;
									if (i === currentPage) {
										btn.classList.add("active");
									}
									btn.addEventListener("click", (function(
											page) {
										return function() {
											currentPage = page;
											updateTable();
											updatePagination();
										};
									})(i));
									pageNumbersElement.appendChild(btn);
								}
							}

							document
									.getElementById("prevGroup")
									.addEventListener(
											"click",
											function() {
												var startPage = Math
														.floor((currentPage - 1)
																/ pageGroupSize)
														* pageGroupSize + 1;
												if (startPage > 1) {
													currentPage = startPage - 1;
													updateTable();
													updatePagination();
												}
											});

							document
									.getElementById("nextGroup")
									.addEventListener(
											"click",
											function() {
												var startPage = Math
														.floor((currentPage - 1)
																/ pageGroupSize)
														* pageGroupSize + 1;
												var endPage = Math
														.min(startPage
																+ pageGroupSize
																- 1, totalPages);
												if (endPage < totalPages) {
													currentPage = endPage + 1;
													updateTable();
													updatePagination();
												}
											});

							document
									.getElementById("fragileCheckbox")
									.addEventListener(
											"change",
											function() {
												document
														.getElementById("fragileHidden").disabled = this.checked;
											});

							document.getElementById("submit-btn")
									.addEventListener(
											"click",
											function() {
												document.getElementById(
														"productAdd").submit();
											});

							updateTable();
							updatePagination();
						});
	</script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
		rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
		crossorigin="anonymous">
</body>
</html>
