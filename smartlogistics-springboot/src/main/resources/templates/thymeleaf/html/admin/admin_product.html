<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="~{/thymeleaf/html/common/default_layout}">
<head>
  <meta charset="UTF-8">
  <title>Product List</title>
  <th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <style>
      /* 테이블 기본 스타일 */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
      }
      /* 페이징 버튼 스타일 */
      .pagination {
        text-align: center;
        margin-bottom: 20px;
      }
      .pagination button {
        padding: 5px 10px;
        margin: 0 2px;
        border: 1px solid #ccc;
        background-color: #fff;
        cursor: pointer;
      }
      .pagination button.active {
        background-color: #007bff;
        color: #fff;
      }
      .pagination button:disabled {
        opacity: 0.5;
        cursor: default;
      }
    </style>
  </th:block>
</head>
<body>
<th:block layout:fragment="wrapper">
  <div class="outside-container">
    <div class="main-container">
      <!-- 공통 프로필, 사이드바 include -->
      <div th:replace="~{thymeleaf/html/common/include::profile}"></div>
      <div th:replace="~{thymeleaf/html/common/include::sidebar}"></div>
      <!-- 본문 콘텐츠 영역 -->
      <div layout:fragment="content" class="main-content">
            	
				    <body>
					<h1>Product List</h1>
					
					<table border="1">
					    <thead>
					        <tr>
					            <th>NO.</th>
					            <th>Name</th>
					            <th>Width</th>
					            <th>Depth</th>
					            <th>Height</th>
					            <th>Weight</th>
					            <th>Category</th>
					            <th>Fragile</th>
					            <th>Actions</th>
					        </tr>
					    </thead>
						<tbody>
						    <tr th:each="product, iterStat : ${products}">
						        <td th:text="${iterStat.index + 1}"></td> <!-- ID 대신 1부터 시작하는 인덱스 -->
						        <td th:text="${product.name}"></td>
						        <td th:text="${product.width}"></td>
						        <td th:text="${product.depth}"></td>
						        <td th:text="${product.height}"></td>
						        <td th:text="${product.weight}"></td>
						        <td th:text="${product.category}"></td>
						        <td th:text="${product.fragile != null ? (product.fragile ? 'Yes' : 'No') : 'No'}"></td>
						        <td>
						            <form th:action="@{/admin/product/update}" method="post">
						                <input type="hidden" name="productId" th:value="${product.productId}" />
						                <button type="submit">Edit</button>
						            </form>
						            <a th:href="@{/admin/product/delete/{id}(id=${product.productId})}">Delete</a>
						        </td>
						    </tr>
						</tbody>

					</table>
					
					<div id="pagination" class="pagination"></div>
        
					
					<!-- 제품 추가 폼 -->
					<!-- 제품 추가 폼 -->
					<h2>Add Product</h2>
					<form th:action="@{/admin/product/add}" method="post">
					    Name: <input type="text" name="name" required /><br/>
					    Width: <input type="number" name="width" required /><br/>
					    Depth: <input type="number" name="depth" required /><br/>
					    Height: <input type="number" name="height" required /><br/>
					    Weight: <input type="number" name="weight" required /><br/>
					    
					    <!-- 카테고리를 선택할 수 있도록 select 추가 -->
					    Category: 
					    <select name="category" required>
					        <option value="잡화류">잡화류</option>
					        <option value="전자제품류">전자제품류</option>
					        <option value="가공식품">가공식품</option>
					        <option value="제과류">제과류</option>
					        <option value="음료">음료</option>
					        <option value="의류">의류</option>
					        <option value="세정용 화장품류">세정용 화장품류</option>
					        <option value="그 밖의 화장품류">그 밖의 화장품류</option>
					        <option value="의약외품류">의약외품류</option>
					        <option value="세제류">세제류</option>
					        <option value="건강기능식품">건강기능식품</option>
					    </select><br/>
					
					    Fragile: 
						<input type="checkbox" name="fragile" id="fragileCheckbox" th:checked="${product != null && product.fragile}" value="true" />
						<input type="hidden" name="fragile" id="fragileHidden" value="false" />
						
						<script>
						    document.getElementById("fragileCheckbox").addEventListener("change", function() {
						        document.getElementById("fragileHidden").disabled = this.checked;
						    });
						</script>
					    
					    <button type="submit">Add Product</button>
					</form>
					
          <script>
          document.addEventListener("DOMContentLoaded", function () {
            const table = document.getElementById("productTable");
            const tbody = table.querySelector("tbody");
            let rows = Array.from(tbody.querySelectorAll("tr"));
            const rowsPerPage = 10;
            const pagination = document.getElementById("pagination");
            let currentPage = 1;
            
            // 지정 페이지에 해당하는 행만 표시하는 함수
            function displayPage(page) {
              currentPage = page;
              // 새로운 행이 추가되었을 경우를 대비해 rows 배열을 갱신
              rows = Array.from(tbody.querySelectorAll("tr"));
              const totalRows = rows.length;
              const totalPages = Math.ceil(totalRows / rowsPerPage);
              
              rows.forEach((row, index) => {
                row.style.display = (index >= (page - 1) * rowsPerPage && index < page * rowsPerPage) ? "" : "none";
              });
              
              updatePagination(totalPages);
            }
            
            // 페이징 버튼 생성 및 업데이트
            function updatePagination(totalPages) {
              pagination.innerHTML = "";
              
              const prevButton = document.createElement("button");
              prevButton.textContent = "« Previous";
              prevButton.disabled = currentPage === 1;
              prevButton.addEventListener("click", () => {
                if (currentPage > 1) displayPage(currentPage - 1);
              });
              pagination.appendChild(prevButton);
              
              for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement("button");
                pageButton.textContent = i;
                if (i === currentPage) {
                  pageButton.classList.add("active");
                }
                pageButton.addEventListener("click", () => displayPage(i));
                pagination.appendChild(pageButton);
              }
              
              const nextButton = document.createElement("button");
              nextButton.textContent = "Next »";
              nextButton.disabled = currentPage === totalPages;
              nextButton.addEventListener("click", () => {
                if (currentPage < totalPages) displayPage(currentPage + 1);
              });
              pagination.appendChild(nextButton);
            }
            
            // 초기 페이지 로딩
            displayPage(1);
            
            // 물품 추가 기능 처리
            const addProductForm = document.getElementById("addProductForm");
            addProductForm.addEventListener("submit", function (event) {
              event.preventDefault();
              const formData = new FormData(addProductForm);
              const name = formData.get("name");
              const width = formData.get("width");
              const depth = formData.get("depth");
              const height = formData.get("height");
              const weight = formData.get("weight");
              const category = formData.get("category");
              const fragile = addProductForm.querySelector("[name='fragile']").checked ? "Yes" : "No";
              
              const newRow = document.createElement("tr");
              newRow.innerHTML = `
                <td>${tbody.querySelectorAll("tr").length + 1}</td>
                <td>${name}</td>
                <td>${width}</td>
                <td>${depth}</td>
                <td>${height}</td>
                <td>${weight}</td>
                <td>${category}</td>
                <td>${fragile}</td>
                <td>Edit | Delete</td>
              `;
              tbody.appendChild(newRow);
              addProductForm.reset();
              displayPage(currentPage);
            });
          });
        </script>
      </div>
      <!-- // main-content -->
    </div>
    <!-- // main-container -->
  </div>
  <!-- // outside-container -->
</th:block>
</body>
</html>