<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="app.labs.dao.ProgressDao">

    <!-- 필터링된 진행 상태 목록 조회 -->
    <select id="getFilteredProgressList" resultType="app.labs.model.ProgressDTO">
        SELECT o.order_id, o.order_num, o.order_time, o.destination, o.pallet_id, 
       o.box_state, o.progress_state,  
       p.name AS productName, p.category AS productCategory
		FROM `order` o
		LEFT JOIN `product` p ON o.product_id = p.product_id
		WHERE (#{date} IS NULL OR DATE(o.order_time) = #{date})
		  AND (#{camp} IS NULL OR o.destination = #{camp})
		  AND (#{orderNum} IS NULL OR o.order_num = #{orderNum})
		ORDER BY o.order_time ASC
		LIMIT #{pageSize} OFFSET #{offset}

    </select>

    <!-- 필터링된 진행 상태 개수 조회 -->
	<select id="countTotalFilteredProgress" resultType="int">
	    SELECT COUNT(*)
	    FROM `order` o
	    LEFT JOIN `product` p ON o.product_id = p.product_id
	    WHERE (#{date} IS NULL OR DATE(o.order_time) = #{date})
	      AND (#{camp} IS NULL OR o.destination = #{camp})
	      AND (#{orderNum} IS NULL OR o.order_num = #{orderNum})
	</select>


</mapper>
