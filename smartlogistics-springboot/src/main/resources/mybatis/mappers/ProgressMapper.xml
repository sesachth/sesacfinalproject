<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="app.labs.dao.ProgressDao">

    <!-- 필터링된 진행 상태 목록 조회 -->
    <select id="getFilteredProgressList" resultType="app.labs.model.ProgressDTO">
        SELECT o.orderId, o.orderNum, o.orderTime, o.destination, o.palletId, 
               o.box_state, o.progress_state,  -- ✅ `boxState` → `box_state` 변경
               p.name AS productName, p.category AS productCategory  -- ✅ `p.productName` → `p.name`
        FROM `order` o
        LEFT JOIN `product` p ON o.productId = p.productId
        WHERE (#{date} IS NULL OR DATE(o.orderTime) = #{date})
          AND (#{camp} IS NULL OR o.destination = #{camp})
          AND (#{orderNum} IS NULL OR o.orderNum = #{orderNum})
        ORDER BY o.orderTime ASC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <!-- 필터링된 진행 상태 개수 조회 -->
    <select id="countTotalFilteredProgress" resultType="int">
        SELECT COUNT(*)
        FROM `order` o
        LEFT JOIN `product` p ON o.productId = p.productId
        WHERE (#{date} IS NULL OR DATE(o.orderTime) = #{date})
          AND (#{camp} IS NULL OR o.destination = #{camp})
          AND (#{orderNum} IS NULL OR o.orderNum = #{orderNum})
    </select>

</mapper>
